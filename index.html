<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Islamic Prayer Times by Location</title>
  <meta name="description" content="Get accurate daily Islamic prayer times based on your current location using Geolocation. Supports multiple calculation methods.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f7fa;
      color: #0A166C;
      padding: 20px;
    }
    table {
      margin: auto;
      border-collapse: collapse;
      width: 320px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }
    h1, #locationLabel {
      text-align: center;
    }
    #methodSelector {
      display: block;
      margin: 10px auto;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <h1>Islamic Prayer Times by Location</h1>
  <p style="text-align:center;">Automatically calculated daily prayer times using your current location.</p>

  <label for="methodSelector" style="text-align:center; display:block;">Select Calculation Method:</label>
  <select id="methodSelector">
    <option value="Jafari" selected>Jafari (Default)</option>
    <option value="Tehran">Tehran</option>
    <option value="MWL">Muslim World League</option>
    <option value="ISNA">Islamic Society of North America</option>
    <option value="Egypt">Egyptian General Authority of Survey</option>
    <option value="Makkah">Umm al-Qura University, Makkah</option>
    <option value="Karachi">University of Islamic Sciences, Karachi</option>
  </select>

  <div id="locationLabel">Fetching your location...</div>
  <div id="table"></div>

  <!-- Load PrayTimes.js -->
  <script src="PrayTimes.js"></script>

  <script>
    // Set default method
    prayTimes.setMethod('Jafari');

    let currentCoords = null;
    let currentLocationName = '';

    function renderPrayerTimes(lat, lon, locationName) {
      const date = new Date();
      // const timezoneOffset = -date.getTimezoneOffset() / 60; // in hours
      const times = prayTimes.getTimes(date, [lat, lon], 'auto', 'auto', '12h');

      // Determine which times to display based on method
      const method = prayTimes.getMethod();
      let list = ['Imsak', 'Fajr', 'Sunrise', 'Dhuhr', 'Sunset', 'Maghrib'];
      if (method !== 'Jafari' && method !== 'Tehran') {
        list.push('Asr', 'Isha');
      }

      document.getElementById('locationLabel').textContent = "Prayer Times for " + locationName;

      let html = '<table>';
      html += '<tr><th colspan="2">' + date.toDateString() + '</th></tr>';
      for (let i = 0; i < list.length; i++) {
        html += '<tr><td>' + list[i] + '</td><td>' + times[list[i].toLowerCase()] + '</td></tr>';
      }
      html += '</table>';

      document.getElementById('table').innerHTML = html;
    }

    function fetchLocation() {
      if (!navigator.geolocation) {
        document.getElementById('locationLabel').textContent = "Geolocation is not supported.";
        return;
      }

      navigator.geolocation.getCurrentPosition(
        function(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          currentCoords = { lat, lon };

          // Optional: Use OpenCage reverse geocoding for friendly location name
          const apiKey = 'b2ffbeb936c44b8f86a2ed97048d00ea'; // Replace with your API key or remove this block
          fetch(`https://api.opencagedata.com/geocode/v1/json?q=${lat}+${lon}&key=${apiKey}`)
            .then(response => response.json())
            .then(data => {
              currentLocationName = data.results[0]?.formatted || `(${lat.toFixed(2)}, ${lon.toFixed(2)})`;
              renderPrayerTimes(lat, lon, currentLocationName);
            })
            .catch(() => {
              currentLocationName = `(${lat.toFixed(2)}, ${lon.toFixed(2)})`;
              renderPrayerTimes(lat, lon, currentLocationName);
            });
        },
        function(error) {
          document.getElementById('locationLabel').textContent = "Location access denied.";
        }
      );
    }

    document.getElementById('methodSelector').addEventListener('change', function() {
      const selectedMethod = this.value;
      prayTimes.setMethod(selectedMethod);
      if (currentCoords && currentLocationName) {
        renderPrayerTimes(currentCoords.lat, currentCoords.lon, currentLocationName);
      }
    });

    fetchLocation();
  </script>

  <footer style="text-align:center; margin-top:40px;">
    <p>&copy; 2025 Prayer Times App</p>
  </footer>

</body>
</html>
