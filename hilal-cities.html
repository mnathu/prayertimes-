<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hilal Cities</title>
<script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>

<style>
body { font-family:Arial; background:#f9f9f9; padding:20px; }
h2 { text-align:center; }
table {
width:100%;
border-collapse:collapse;
background:white;
}
th, td {
padding:10px;
border:1px solid #ddd;
text-align:center;
}
th { background:#222; color:white; }
a { color:#0066cc; text-decoration:none; }
</style>
</head>
<body>

<h2>Major North American Cities</h2>

<input type="date" id="datePicker">
<div id="hijriDate"></div>
<br>
<a href="hilal-forecast.html">‚Üê Back to Map</a>
<br><br>

<table>
<thead>
<tr>
<th>City</th>
<th>Visibility</th>
</tr>
</thead>
<tbody id="cityTable"></tbody>
</table>

<script>

// Same 29th Hijri logic
function getNext29Hijri() {
    const today = new Date();
    for(let i=0;i<60;i++){
        let test = new Date();
        test.setDate(today.getDate()+i);
        const hijri = new Intl.DateTimeFormat('en-TN-u-ca-islamic', {
            day:'numeric'
        }).format(test);
        if(hijri==="29") return test;
    }
    return today;
}

const defaultDate = getNext29Hijri();
document.getElementById("datePicker").valueAsDate = defaultDate;

// Same math functions copied
function getElongation(date, lat, lon){
    const sunPos = SunCalc.getPosition(date, lat, lon);
    const moonPos = SunCalc.getMoonPosition(date, lat, lon);

    const cosE =
        Math.sin(sunPos.altitude)*Math.sin(moonPos.altitude) +
        Math.cos(sunPos.altitude)*Math.cos(moonPos.altitude)*
        Math.cos(sunPos.azimuth - moonPos.azimuth);

    return Math.acos(cosE) * (180/Math.PI);
}

function classifyVisibility(date, lat, lon){

    const times = SunCalc.getTimes(date, lat, lon);
    const sunset = new Date(times.sunset.getTime()+5*60000);

    const sunPos = SunCalc.getPosition(sunset, lat, lon);
    const moonPos = SunCalc.getMoonPosition(sunset, lat, lon);

    const moonAlt = moonPos.altitude * 180/Math.PI;
    const sunAlt = sunPos.altitude * 180/Math.PI;
    const elong = getElongation(sunset, lat, lon);

    const arcv = moonAlt - sunAlt;
    const q = arcv - (0.1018*elong*elong - 1.162*elong + 6.322);

    if(q > 0.216) return "üü¢ Easily Visible (A)";
    if(q > -0.014) return "üü¢ Perfect Conditions (B)";
    if(q > -0.160) return "üü° Optical Aid (C)";
    if(q > -0.232) return "üü† Very Difficult (D)";
    return "üî¥ Not Visible (E)";
}

const cities = [
{ name:"New York", lat:40.71, lon:-74.00 },
{ name:"Chicago", lat:41.88, lon:-87.63 },
{ name:"Houston", lat:29.76, lon:-95.37 },
{ name:"Los Angeles", lat:34.05, lon:-118.24 },
{ name:"Toronto", lat:43.65, lon:-79.38 },
{ name:"Vancouver", lat:49.28, lon:-123.12 }
];

function updateTable(){

    const date = new Date(document.getElementById("datePicker").value);

    const hijri = new Intl.DateTimeFormat('en-TN-u-ca-islamic', {
        day:'numeric', month:'long', year:'numeric'
    }).format(date);

    document.getElementById("hijriDate").innerHTML = hijri;

    const table = document.getElementById("cityTable");
    table.innerHTML = "";

    cities.forEach(city=>{
        const result = classifyVisibility(date, city.lat, city.lon);
        table.innerHTML += `<tr><td>${city.name}</td><td>${result}</td></tr>`;
    });
}

document.getElementById("datePicker").addEventListener("change",updateTable);
updateTable();

</script>

</body>
</html>
